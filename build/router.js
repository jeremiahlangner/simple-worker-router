var nt=Object.defineProperty;var _=(t,e)=>()=>(t&&(e=t(t=0)),e);var it=(t,e)=>{for(var s in e)nt(t,s,{get:e[s],enumerable:!0})};function ot(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function G(t,e=!1){let s=[],n=0;for(;n<t.length;){let o=t[n],u=function(h){if(!e)throw new TypeError(h);s.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(o==="*"){s.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(o==="+"||o==="?"){s.push({type:"OTHER_MODIFIER",index:n,value:t[n++]});continue}if(o==="\\"){s.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(o==="{"){s.push({type:"OPEN",index:n,value:t[n++]});continue}if(o==="}"){s.push({type:"CLOSE",index:n,value:t[n++]});continue}if(o===":"){let h="",r=n+1;for(;r<t.length;){let a=t.substr(r,1);if(r===n+1&&ht.test(a)||r!==n+1&&at.test(a)){h+=t[r++];continue}break}if(!h){u(`Missing parameter name at ${n}`);continue}s.push({type:"NAME",index:n,value:h}),n=r;continue}if(o==="("){let h=1,r="",a=n+1,i=!1;if(t[a]==="?"){u(`Pattern cannot start with "?" at ${a}`);continue}for(;a<t.length;){if(!ot(t[a],!1)){u(`Invalid character '${t[a]}' at ${a}.`),i=!0;break}if(t[a]==="\\"){r+=t[a++]+t[a++];continue}if(t[a]===")"){if(h--,h===0){a++;break}}else if(t[a]==="("&&(h++,t[a+1]!=="?")){u(`Capturing groups are not allowed at ${a}`),i=!0;break}r+=t[a++]}if(i)continue;if(h){u(`Unbalanced pattern at ${n}`);continue}if(!r){u(`Missing pattern at ${n}`);continue}s.push({type:"REGEX",index:n,value:r}),n=a;continue}s.push({type:"CHAR",index:n,value:t[n++]})}return s.push({type:"END",index:n,value:""}),s}function W(t,e={}){let s=G(t);e.delimiter??="/#?",e.prefixes??="./";let n=`[^${g(e.delimiter)}]+?`,o=[],u=0,h=0,r="",a=new Set,i=p=>{if(h<s.length&&s[h].type===p)return s[h++].value},f=()=>i("OTHER_MODIFIER")??i("ASTERISK"),y=p=>{let c=i(p);if(c!==void 0)return c;let{type:l,index:v}=s[h];throw new TypeError(`Unexpected ${l} at ${v}, expected ${p}`)},R=()=>{let p="",c;for(;c=i("CHAR")??i("ESCAPED_CHAR");)p+=c;return p},rt=p=>p,U=e.encodePart||rt,A="",O=p=>{A+=p},I=()=>{A.length&&(o.push(new T(3,"","",U(A),"",3)),A="")},M=(p,c,l,v,b)=>{let d=3;switch(b){case"?":d=1;break;case"*":d=0;break;case"+":d=2;break}if(!c&&!l&&d===3){O(p);return}if(I(),!c&&!l){if(!p)return;o.push(new T(3,"","",U(p),"",d));return}let m;l?l==="*"?m=H:m=l:m=n;let L=2;m===n?(L=1,m=""):m===H&&(L=0,m="");let x;if(c?x=c:l&&(x=u++),a.has(x))throw new TypeError(`Duplicate name '${x}'.`);a.add(x),o.push(new T(L,x,U(p),m,U(v),d))};for(;h<s.length;){let p=i("CHAR"),c=i("NAME"),l=i("REGEX");if(!c&&!l&&(l=i("ASTERISK")),c||l){let b=p??"";e.prefixes.indexOf(b)===-1&&(O(b),b=""),I();let d=f();M(b,c,l,"",d);continue}let v=p??i("ESCAPED_CHAR");if(v){O(v);continue}if(i("OPEN")){let b=R(),d=i("NAME"),m=i("REGEX");!d&&!m&&(m=i("ASTERISK"));let L=R();y("CLOSE");let x=f();M(b,d,m,L,x);continue}I(),y("END")}return o}function g(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function j(t){return t&&t.ignoreCase?"ui":"u"}function ut(t,e,s){return K(W(t,s),e,s)}function k(t){switch(t){case 0:return"*";case 1:return"?";case 2:return"+";case 3:return""}}function K(t,e,s={}){s.delimiter??="/#?",s.prefixes??="./",s.sensitive??=!1,s.strict??=!1,s.end??=!0,s.start??=!0,s.endsWith="";let n=s.start?"^":"";for(let r of t){if(r.type===3){r.modifier===3?n+=g(r.value):n+=`(?:${g(r.value)})${k(r.modifier)}`;continue}e&&e.push(r.name);let a=`[^${g(s.delimiter)}]+?`,i=r.value;if(r.type===1?i=a:r.type===0&&(i=H),!r.prefix.length&&!r.suffix.length){r.modifier===3||r.modifier===1?n+=`(${i})${k(r.modifier)}`:n+=`((?:${i})${k(r.modifier)})`;continue}if(r.modifier===3||r.modifier===1){n+=`(?:${g(r.prefix)}(${i})${g(r.suffix)})`,n+=k(r.modifier);continue}n+=`(?:${g(r.prefix)}`,n+=`((?:${i})(?:`,n+=g(r.suffix),n+=g(r.prefix),n+=`(?:${i}))*)${g(r.suffix)})`,r.modifier===0&&(n+="?")}let o=`[${g(s.endsWith)}]|$`,u=`[${g(s.delimiter)}]`;if(s.end)return s.strict||(n+=`${u}?`),s.endsWith.length?n+=`(?=${o})`:n+="$",new RegExp(n,j(s));s.strict||(n+=`(?:${u}(?=${o}))?`);let h=!1;if(t.length){let r=t[t.length-1];r.type===3&&r.modifier===3&&(h=s.delimiter.indexOf(r)>-1)}return h||(n+=`(?=${u}|${o})`),new RegExp(n,j(s))}function ft(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function X(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function lt(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function q(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}function z(t){if(!t)return!0;for(let e of V)if(t.test(e))return!0;return!1}function mt(t,e){if(t=X(t,"#"),e||t==="")return t;let s=new URL("https://example.com");return s.hash=t,s.hash?s.hash.substring(1,s.hash.length):""}function gt(t,e){if(t=X(t,"?"),e||t==="")return t;let s=new URL("https://example.com");return s.search=t,s.search?s.search.substring(1,s.search.length):""}function dt(t,e){return e||t===""?t:q(t)?J(t):B(t)}function yt(t,e){if(e||t==="")return t;let s=new URL("https://example.com");return s.password=t,s.password}function wt(t,e){if(e||t==="")return t;let s=new URL("https://example.com");return s.username=t,s.username}function bt(t,e,s){if(s||t==="")return t;if(e&&!V.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function xt(t,e,s){return Z(e)===t&&(t=""),s||t===""?t:Q(t)}function Et(t,e){return t=lt(t,":"),e||t===""?t:D(t)}function Z(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function D(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function $t(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function Rt(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function B(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function J(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function Q(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function vt(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function kt(t){return t===""?t:new URL(`data:${t}`).pathname}function Lt(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function Pt(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}function F(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let s=new URL(t,e);return{protocol:s.protocol.substring(0,s.protocol.length-1),username:s.username,password:s.password,hostname:s.hostname,port:s.port,pathname:s.pathname,search:s.search!==""?s.search.substring(1,s.search.length):void 0,hash:s.hash!==""?s.hash.substring(1,s.hash.length):void 0}}function w(t,e){return e?C(t):t}function P(t,e,s){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=w(n.protocol.substring(0,n.protocol.length-1),s),t.username=w(n.username,s),t.password=w(n.password,s),t.hostname=w(n.hostname,s),t.port=w(n.port,s),t.pathname=w(n.pathname,s),t.search=w(n.search.substring(1,n.search.length),s),t.hash=w(n.hash.substring(1,n.hash.length),s)}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=Et(e.protocol,s)),typeof e.username=="string"&&(t.username=wt(e.username,s)),typeof e.password=="string"&&(t.password=yt(e.password,s)),typeof e.hostname=="string"&&(t.hostname=dt(e.hostname,s)),typeof e.port=="string"&&(t.port=xt(e.port,t.protocol,s)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!ft(t.pathname,s)){let o=n.pathname.lastIndexOf("/");o>=0&&(t.pathname=w(n.pathname.substring(0,o+1),s)+t.pathname)}t.pathname=bt(t.pathname,t.protocol,s)}return typeof e.search=="string"&&(t.search=gt(e.search,s)),typeof e.hash=="string"&&(t.hash=mt(e.hash,s)),t}function C(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function Tt(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Ut(t,e){e.delimiter??="/#?",e.prefixes??="./",e.sensitive??=!1,e.strict??=!1,e.end??=!0,e.start??=!0,e.endsWith="";let s=".*",n=`[^${Tt(e.delimiter)}]+?`,o=/[$_\u200C\u200D\p{ID_Continue}]/u,u="";for(let h=0;h<t.length;++h){let r=t[h];if(r.type===3){if(r.modifier===3){u+=C(r.value);continue}u+=`{${C(r.value)}}${k(r.modifier)}`;continue}let a=r.hasCustomName(),i=!!r.suffix.length||!!r.prefix.length&&(r.prefix.length!==1||!e.prefixes.includes(r.prefix)),f=h>0?t[h-1]:null,y=h<t.length-1?t[h+1]:null;if(!i&&a&&r.type===1&&r.modifier===3&&y&&!y.prefix.length&&!y.suffix.length)if(y.type===3){let R=y.value.length>0?y.value[0]:"";i=o.test(R)}else i=!y.hasCustomName();if(!i&&!r.prefix.length&&f&&f.type===3){let R=f.value[f.value.length-1];i=e.prefixes.includes(R)}i&&(u+="{"),u+=C(r.prefix),a&&(u+=`:${r.name}`),r.type===2?u+=`(${r.value})`:r.type===1?a||(u+=`(${n})`):r.type===0&&(!a&&(!f||f.type===3||f.modifier!==3||i||r.prefix!=="")?u+="*":u+=`(${s})`),r.type===1&&a&&r.suffix.length&&o.test(r.suffix[0])&&(u+="\\"),u+=C(r.suffix),i&&(u+="}"),r.modifier!==3&&(u+=k(r.modifier))}return u}var T,ht,at,H,$,pt,ct,V,Ct,S,E,N,Y=_(()=>{T=class{type=3;name="";prefix="";value="";suffix="";modifier=3;constructor(t,e,s,n,o,u){this.type=t,this.name=e,this.prefix=s,this.value=n,this.suffix=o,this.modifier=u}hasCustomName(){return this.name!==""&&typeof this.name!="number"}},ht=/[$_\p{ID_Start}]/u,at=/[$_\u200C\u200D\p{ID_Continue}]/u,H=".*";$={delimiter:"",prefixes:"",sensitive:!0,strict:!0},pt={delimiter:".",prefixes:"",sensitive:!0,strict:!0},ct={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};V=["ftp","file","http","https","ws","wss"];Ct=class{#i;#r=[];#e={};#t=0;#n=1;#f=0;#o=0;#l=0;#m=0;#g=!1;constructor(t){this.#i=t}get result(){return this.#e}parse(){for(this.#r=G(this.#i,!0);this.#t<this.#r.length;this.#t+=this.#n){if(this.#n=1,this.#r[this.#t].type==="END"){if(this.#o===0){this.#b(),this.#u()?this.#s(9,1):this.#p()?(this.#s(8,1),this.#e.hash=""):(this.#s(7,0),this.#e.search="",this.#e.hash="");continue}else if(this.#o===2){this.#c(5);continue}this.#s(10,0);break}if(this.#l>0)if(this.#L())this.#l-=1;else continue;if(this.#k()){this.#l+=1;continue}switch(this.#o){case 0:this.#x()&&(this.#e.username="",this.#e.password="",this.#e.hostname="",this.#e.port="",this.#e.pathname="",this.#e.search="",this.#e.hash="",this.#c(1));break;case 1:if(this.#x()){this.#T();let t=7,e=1;this.#g&&(this.#e.pathname="/"),this.#$()?(t=2,e=3):this.#g&&(t=2),this.#s(t,e)}break;case 2:this.#y()?this.#c(3):(this.#w()||this.#p()||this.#u())&&this.#c(5);break;case 3:this.#R()?this.#s(4,1):this.#y()&&this.#s(5,1);break;case 4:this.#y()&&this.#s(5,1);break;case 5:this.#P()?this.#m+=1:this.#C()&&(this.#m-=1),this.#v()&&!this.#m?this.#s(6,1):this.#w()?this.#s(7,0):this.#p()?this.#s(8,1):this.#u()&&this.#s(9,1);break;case 6:this.#w()?this.#s(7,0):this.#p()?this.#s(8,1):this.#u()&&this.#s(9,1);break;case 7:this.#p()?this.#s(8,1):this.#u()&&this.#s(9,1);break;case 8:this.#u()&&this.#s(9,1);break;case 9:break;case 10:break}}}#s(t,e){switch(this.#o){case 0:break;case 1:this.#e.protocol=this.#a();break;case 2:break;case 3:this.#e.username=this.#a();break;case 4:this.#e.password=this.#a();break;case 5:this.#e.hostname=this.#a();break;case 6:this.#e.port=this.#a();break;case 7:this.#e.pathname=this.#a();break;case 8:this.#e.search=this.#a();break;case 9:this.#e.hash=this.#a();break;case 10:break}this.#E(t,e)}#E(t,e){this.#o=t,this.#f=this.#t+e,this.#t+=e,this.#n=0}#b(){this.#t=this.#f,this.#n=0}#c(t){this.#b(),this.#o=t}#d(t){return t<0&&(t=this.#r.length-t),t<this.#r.length?this.#r[t]:this.#r[this.#r.length-1]}#h(t,e){let s=this.#d(t);return s.value===e&&(s.type==="CHAR"||s.type==="ESCAPED_CHAR"||s.type==="INVALID_CHAR")}#x(){return this.#h(this.#t,":")}#$(){return this.#h(this.#t+1,"/")&&this.#h(this.#t+2,"/")}#y(){return this.#h(this.#t,"@")}#R(){return this.#h(this.#t,":")}#v(){return this.#h(this.#t,":")}#w(){return this.#h(this.#t,"/")}#p(){if(this.#h(this.#t,"?"))return!0;if(this.#r[this.#t].value!=="?")return!1;let t=this.#d(this.#t-1);return t.type!=="NAME"&&t.type!=="REGEX"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}#u(){return this.#h(this.#t,"#")}#k(){return this.#r[this.#t].type=="OPEN"}#L(){return this.#r[this.#t].type=="CLOSE"}#P(){return this.#h(this.#t,"[")}#C(){return this.#h(this.#t,"]")}#a(){let t=this.#r[this.#t],e=this.#d(this.#f).index;return this.#i.substring(e,t.index)}#T(){let t={};Object.assign(t,$),t.encodePart=D;let e=ut(this.#a(),void 0,t);this.#g=z(e)}},S=["protocol","username","password","hostname","port","pathname","search","hash"],E="*";N=class{#i;#r={};#e={};#t={};#n={};constructor(t={},e,s){try{let n;if(typeof e=="string"?n=e:s=e,typeof t=="string"){let r=new Ct(t);if(r.parse(),t=r.result,n===void 0&&typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");t.baseURL=n}else{if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(n)throw new TypeError("parameter 1 is not of type 'string'.")}typeof s>"u"&&(s={ignoreCase:!1});let o={ignoreCase:s.ignoreCase===!0},u={pathname:E,protocol:E,username:E,password:E,hostname:E,port:E,search:E,hash:E};this.#i=P(u,t,!0),Z(this.#i.protocol)===this.#i.port&&(this.#i.port="");let h;for(h of S){if(!(h in this.#i))continue;let r={},a=this.#i[h];switch(this.#e[h]=[],h){case"protocol":Object.assign(r,$),r.encodePart=D;break;case"username":Object.assign(r,$),r.encodePart=$t;break;case"password":Object.assign(r,$),r.encodePart=Rt;break;case"hostname":Object.assign(r,pt),q(a)?r.encodePart=J:r.encodePart=B;break;case"port":Object.assign(r,$),r.encodePart=Q;break;case"pathname":z(this.#r.protocol)?(Object.assign(r,ct,o),r.encodePart=vt):(Object.assign(r,$,o),r.encodePart=kt);break;case"search":Object.assign(r,$,o),r.encodePart=Lt;break;case"hash":Object.assign(r,$,o),r.encodePart=Pt;break}try{this.#n[h]=W(a,r),this.#r[h]=K(this.#n[h],this.#e[h],r),this.#t[h]=Ut(this.#n[h],r)}catch{throw new TypeError(`invalid ${h} pattern '${this.#i[h]}'.`)}}}catch(n){throw new TypeError(`Failed to construct 'URLPattern': ${n.message}`)}}test(t={},e){let s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?s=P(s,t,!1):s=P(s,F(t,e),!1)}catch{return!1}let n;for(n of S)if(!this.#r[n].exec(s[n]))return!1;return!0}exec(t={},e){let s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?s=P(s,t,!1):s=P(s,F(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let o;for(o of S){let u=this.#r[o].exec(s[o]);if(!u)return null;let h={};for(let[r,a]of this.#e[o].entries())if(typeof a=="string"||typeof a=="number"){let i=u[r+1];h[a]=i}n[o]={input:s[o]??"",groups:h}}return n}static compareComponent(t,e,s){let n=(r,a)=>{for(let i of["type","modifier","prefix","value","suffix"]){if(r[i]<a[i])return-1;if(r[i]!==a[i])return 1}return 0},o=new T(3,"","","","",3),u=new T(0,"","","","",3),h=(r,a)=>{let i=0;for(;i<Math.min(r.length,a.length);++i){let f=n(r[i],a[i]);if(f)return f}return r.length===a.length?0:n(r[i]??o,a[i]??o)};return!e.#t[t]&&!s.#t[t]?0:e.#t[t]&&!s.#t[t]?h(e.#n[t],[u]):!e.#t[t]&&s.#t[t]?h([u],s.#n[t]):h(e.#n[t],s.#n[t])}get protocol(){return this.#t.protocol}get username(){return this.#t.username}get password(){return this.#t.password}get hostname(){return this.#t.hostname}get port(){return this.#t.port}get pathname(){return this.#t.pathname}get search(){return this.#t.search}get hash(){return this.#t.hash}}});var tt={};it(tt,{URLPattern:()=>N});var et=_(()=>{Y();globalThis.URLPattern||(globalThis.URLPattern=N)});var st=class{routes=[];constructor(e=[]){globalThis.URLPattern?this.setup(e):Promise.resolve().then(()=>(et(),tt)).then(()=>this.setup(e))}setup(e){for(let s of e)this.register(...s)}register(e,s,n="GET"){this.routes.push({path:new URLPattern({pathname:e}),method:n,handler:s})}handle(e){let{request:s}=e;for(let n of this.routes){if(n.method!==s.method)continue;let o=n.path.exec({pathname:new URL(s.url).pathname});if(o)return n.handler({...e,route:o})}return new Response("Not found",{status:404})}};export{st as Router};
